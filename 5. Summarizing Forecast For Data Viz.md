The combined historical and forecast dataset is approximately 20 million lines. PowerBI will take 20 minutes to apply an update to the core dataset. As a result, I summarize the data using the following queries:  

```

DROP TABLE IF EXISTS [summary_pres];


CREATE TABLE [summary_pres] (
	   [yr]					INT
	  ,[mnth]				INT
	  ,[qrtr]				INT
	  --,[qrtr_yr]			        INT
	  ,[line_code]			        VARCHAR (54)
	  ,[lc_prime]                           VARCHAR (54)
	  ,[class_code]		         	VARCHAR (54)
	  ,[cc_type]                            VARCHAR (54)
	  ,[cc_prime]                           VARCHAR (54)
	  ,[pop_code]                           VARCHAR (54)
	  ,[finance_hierarchy]                  VARCHAR (54)
	  ,[Sep_keycust1]                       VARCHAR (54)
	  ,[Aug_keycust1]                       VARCHAR (54)
	  ,[Jul_keycust1]                       VARCHAR (54)
          ,[keycust1_high_level]                VARCHAR (54)
	  ,[keycust2_top_customer]              VARCHAR (54)
          ,[keycust3_territory]                 VARCHAR (54)
          ,[keycust4]                           VARCHAR (54)
	  ,[sales1]				VARCHAR (54)
	  ,[sales2]				VARCHAR (54)
	  ,[sales3]				VARCHAR (54)
	  ,[sales4]                             VARCHAR (54)
	  ,[active_flag]                        VARCHAR (54)
	  ,[measure]			        VARCHAR (54)
	  ,[measure2]			        VARCHAR (54)
	  ,[qtyord]				FLOAT
	  ,[qtyship]			        FLOAT
	  --,[fill_rate]			FLOAT
	  ,[unit_frcst]			        FLOAT
	  ,[$_frcst]			        FLOAT
	  )
INSERT INTO [summary_pres] (
	   [yr]					
	  ,[mnth]				
	  ,[qrtr]				
	  --,[qrtr_yr]			
	  ,[line_code]			
	  ,[lc_prime]           
	  ,[class_code]			
	  ,[cc_type]            
	  ,[cc_prime]           
	  ,[pop_code]
	  ,[finance_hierarchy]
	  ,[Sep_keycust1]      
	  ,[Aug_keycust1]       
	  ,[Jul_keycust1]       
          ,[keycust1_high_level] 
	  ,[keycust2_top_customer]
          ,[keycust3_territory]
          ,[keycust4]           
	  ,[sales1]				
	  ,[sales2]				
	  ,[sales3]				
	  ,[sales4]
	  ,[active_flag]
	  ,[measure]			
	  ,[measure2]			
	  ,[qtyord]				
	  ,[qtyship]			
	  --,[fill_rate]			
	  ,[unit_frcst]			
	  ,[$_frcst]
	  )
	  
	  ( 
SELECT [yr]					
	  ,[mnth]				
	  ,[qrtr]				
	  --,[qrtr_yr]			
	  ,[line_code]			
	  ,[lc_prime]           
	  ,[class_code]			
	  ,[cc_type]            
	  ,[cc_prime]           
	  ,[pop_code]
	  ,[finance_hierarchy]
	  ,[Sep_keycust1]      
	  ,[Aug_keycust1]       
	  ,[Jul_keycust1]       
          ,[keycust1_high_level] 
	  ,[keycust2_top_customer]
          ,[keycust3_territory]
          ,[keycust4]           
	  ,[sales1]				
	  ,[sales2]				
	  ,[sales3]				
	  ,[sales4]
	  ,[active_flag]
	  ,[measure]			
	  ,[measure2]
	  ,SUM([qtyord])
	  ,SUM([qtyship])
	  --,CASE WHEN ( SUM([qtyord]) = 0) THEN NULL
			--ELSE ( SUM([qtyship]) / SUM([qtyord]) )
			--END
	  ,SUM([unit_frcst_use])
	  ,SUM([$_frcst_use])
  FROM [LOCKED_2020_10_sku_v3_presub]
GROUP BY [yr]					
	  ,[mnth]				
	  ,[qrtr]				
	  --,[qrtr_yr]			
	  ,[line_code]			
	  ,[lc_prime]           
	  ,[class_code]			
	  ,[cc_type]            
	  ,[cc_prime]           
	  ,[pop_code]
	  ,[finance_hierarchy]
	  ,[Sep_keycust1]      
	  ,[Aug_keycust1]       
	  ,[Jul_keycust1]       
          ,[keycust1_high_level] 
	  ,[keycust2_top_customer]
          ,[keycust3_territory]
          ,[keycust4]           
	  ,[sales1]				
	  ,[sales2]				
	  ,[sales3]				
	  ,[sales4]
	  ,[active_flag]
	  ,[measure]			
	  ,[measure2]
	) ; 

INSERT INTO [summary_pres] (
	   [yr]					
	  ,[mnth]				
	  ,[qrtr]				
	  --,[qrtr_yr]			
	  ,[line_code]			
	  ,[lc_prime]           
	  ,[class_code]			
	  ,[cc_type]            
	  ,[cc_prime]           
	  ,[pop_code]			
	  --,[Sep_keycust1]      
	  --,[Aug_keycust1]       
	  --,[Jul_keycust1]       
          ,[keycust1_high_level] 
	  ,[keycust2_top_customer]
          ,[keycust3_territory]
          ,[keycust4]           
	  --,[sales1]				
	  ,[sales2]				
	  ,[sales3]				
	  ,[sales4]
	  ,[measure]			
	  --,[measure2]			
	  ,[qtyord]				
	  ,[qtyship]			
	  --,[fill_rate]			
	  ,[unit_frcst]			
	  ,[$_frcst]
	  )
	  ( 
SELECT [yr]
	  ,[mnth]
	  ,[qrtr]
	  --,[qrtr_yr]
	  ,[line_code]
	  ,[lc_prime]
	  ,[class_code]
	  ,[cc_type]
	  ,[cc_prime]
	  ,[pop_code]
	  --,[finance_hierarchy]
	  --,[Jul_keycust1] 
	  ,[LM_keycust1]
	  ,[keycust1]
	  ,[territory]
	  ,[keycust3]
	  ,[sales1]
	  ,[sales2]
	  ,[sales3]
	  ,'LM frcst'
	  --,'LM frcst'
	  ,SUM([qtyord])
	  ,SUM([qtyship])
	  --,CASE WHEN ( SUM([qtyord]) = 0) THEN NULL
		--	ELSE ( SUM([qtyship]) / SUM([qtyord]) )
			--END
	  ,SUM([unit_frcst])
	  ,SUM([$_frcst])
  FROM [LOCKED_2020_9_summary_EOC FINAL]
  WHERE [yr] IN ('2020', '2021')
    AND [measure] NOT IN ('LM Frcst')
 GROUP BY [yr]
	  ,[mnth]
	  ,[qrtr]
	  --,[qrtr_yr]
	  ,[line_code]
	  ,[lc_prime]
	  ,[class_code]
	  ,[cc_type]
	  ,[cc_prime]
	  ,[pop_code]
	  --,[finance_hierarchy]
	  --,[Jul_keycust1] 
	  ,[LM_keycust1]
	  ,[keycust1]
	  ,[territory]
	  ,[keycust3]
	  ,[sales1]
	  ,[sales2]
	  ,[sales3]
	  ,[measure]			
	  ,[measure2]
	) ; 
   ```
   
   Add columns for data visualization purposes.
   
   ``` 
ALTER TABLE [summary_pres]
	ADD [2017 Actuals] FLOAT

ALTER TABLE [summary_pres]
	ADD [2018 Actuals] FLOAT

ALTER TABLE [summary_pres]
	ADD [2019 Actuals] FLOAT

ALTER TABLE [summary_pres]
	ADD [2020 Actuals] FLOAT

ALTER TABLE [summary_pres]
	ADD [2020 Forecast] FLOAT

ALTER TABLE [summary_pres]
	ADD [2021 Forecast] FLOAT

ALTER TABLE [summary_pres]
	ADD [2017 Actuals U] FLOAT

ALTER TABLE [summary_pres]
	ADD [2018 Actuals U] FLOAT

ALTER TABLE [summary_pres]
	ADD [2019 Actuals U] FLOAT

ALTER TABLE [summary_pres]
	ADD [2020 Actuals U] FLOAT

ALTER TABLE [summary_pres]
	ADD [2020 Forecast U] FLOAT

ALTER TABLE [summary_pres]
	ADD [2021 Forecast U] FLOAT

ALTER TABLE [summary_pres]
	ADD [mnth_alph] VARCHAR(54)
	
ALTER TABLE [summary_pres]
	ADD [quarter] VARCHAR(54)

ALTER TABLE [summary_pres]
	ADD [3] VARCHAR(54)
	
ALTER TABLE [summary_pres]
	ADD [tr3_ord] INT

ALTER TABLE [summary_pres]
	ADD [color_measure] INT
   ```   
   
 Populate the added columns:
 
 ```
UPDATE [summary_pres]
   SET [2017 Actuals] = [$_frcst]
			WHERE [measure2] IN ('2017 Actuals')

UPDATE [summary_pres]
   SET [2018 Actuals] = [$_frcst]
			WHERE [measure2] IN ('2018 Actuals')

UPDATE [summary_pres]
   SET [2019 Actuals] = [$_frcst]
			WHERE [measure2] IN ('2019 Actuals')

UPDATE [summary_pres]
   SET [2020 Actuals] = [$_frcst]
			WHERE [measure2] IN ('2020 Actuals')

UPDATE [summary_pres]
   SET [2020 Forecast] = [$_frcst]
			WHERE [measure2] IN ('2020 Forecast')

UPDATE [summary_pres]
   SET [2021 Forecast] = [$_frcst]
			WHERE [measure2] IN ('2021 Forecast')

UPDATE [summary_pres]
   SET [2017 Actuals U] = [unit_frcst]
			WHERE [measure2] IN ('2017 Actuals')

UPDATE [summary_pres]
   SET [2018 Actuals U] = [unit_frcst]
			WHERE [measure2] IN ('2018 Actuals')

UPDATE [summary_pres]
   SET [2019 Actuals U] = [unit_frcst]
			WHERE [measure2] IN ('2019 Actuals')

UPDATE [summary_pres]
   SET [2020 Actuals U] = [unit_frcst]
			WHERE [measure2] IN ('2020 Actuals')

UPDATE [summary_pres]
   SET [2020 Forecast U] = [unit_frcst]
			WHERE [measure2] IN ('2020 Forecast')

UPDATE [summary_pres]
   SET [2021 Forecast U] = [unit_frcst]
			WHERE [measure2] IN ('2021 Forecast')

UPDATE [summary_pres]
   SET [qrtr] = CASE WHEN [mnth] IN ('1', '2', '3') THEN '1'
					 WHEN [mnth] IN ('4', '5', '6') THEN '2'
					 WHEN [mnth] IN ('7', '8', '9') THEN '3'
					 WHEN [mnth] IN ('10', '11', '12') THEN '4'
					 ELSE NULL END

UPDATE [summary_pres]
   SET [3] = CASE WHEN [mnth] IN ('7', '8','9') THEN ('backward_3')
			 WHEN [mnth] IN ('11', '12', '1') THEN ('forward_3')
			 ELSE NULL END; 

UPDATE [summary_pres]
   SET [mnth_alph] = CASE WHEN [mnth] IN ('1') THEN ('Jan')
			WHEN [mnth] IN ('2') THEN ('Feb')
			WHEN [mnth] IN ('3') THEN ('Mar')
			WHEN [mnth] IN ('4') THEN ('Apr')
			WHEN [mnth] IN ('5') THEN ('May')
			WHEN [mnth] IN ('6') THEN ('Jun')
			WHEN [mnth] IN ('7') THEN ('Jul')
			WHEN [mnth] IN ('8') THEN ('Aug')
			WHEN [mnth] IN ('9') THEN ('Sept')
			WHEN [mnth] IN ('10') THEN ('Oct')
			WHEN [mnth] IN ('11') THEN ('Nov')
			WHEN [mnth] IN ('12') THEN ('Dec')
			ELSE NULL END;
				
UPDATE [summary_pres]
   SET [quarter] = CASE WHEN [qrtr] IN ('1') THEN ('Q1')
			WHEN [qrtr] IN ('2') THEN ('Q2')
			WHEN [qrtr] IN ('3') THEN ('Q3')
			WHEN [qrtr] IN ('4') THEN ('Q4')
			ELSE NULL END;
		
UPDATE [summary_pres]
   SET [tr3_ord] = CASE WHEN [3] IN ('backward_3') THEN ('1')
			WHEN [3] IN ('forward_3') THEN ('2')
			ELSE NULL END;	
/*
UPDATE [summary_pres]
	SET [color_measure] = CASE WHEN [measure] IN ('actuals') THEN 0
				   WHEN [measure] IN ('forecast') THEN 1
				   WHEN [measure] IN ('LM Forecast') AND [yr] IN ('2020') AND [yr] IN ('1', '2', '3', '4', '5', '6', '7', '8', '9') THEN 1
				   WHEN [measure] IN ('LM Forecast') AND [yr] IN ('2020') AND [yr] IN (''10', '11', '12') THEN 2
				   WHEN [measure] IN ('LM Forecast') AND [yr] IN ('2021') THEN 2
				   ELSE NULL END;	
							   */

UPDATE  [summary_pres]
	SET [measure2] = ('2020 LM Frcst')
	                  WHERE [measure] = 'LM Frcst' AND [yr] = '2020'

UPDATE  [summary_pres]
	SET [measure2] = ('2021 LM Frcst')
	                  WHERE [measure] = 'LM Frcst' AND [yr] = '2021'


UPDATE [summary_pres]
  SET [measure2] = '2020 act/frcst' 
                    WHERE [measure] IN ('forecast', 'actuals') 
		     AND [yr] IN ('2020')  ;

UPDATE [summary_pres]
	SET [color_measure] = CASE WHEN [measure2] IN ('2017 actuals', '2018 actuals', '2019 actuals') THEN 0
			           WHEN [measure2] IN ('2020 act/frcst') AND [mnth] IN ('1', '2', '3', '4', '5', '6', '7', '8', '9') THEN 0
				   WHEN [measure2] IN ('2020 act/frcst') AND [mnth] IN ('10', '11', '12') THEN 1
				   WHEN [measure2] IN ('2021 forecast') THEN 1
				   WHEN [measure2] IN ('2020 LM Frcst') AND [yr] IN ('2020') AND [mnth] IN ('1', '2', '3', '4', '5', '6', '7', '8') THEN 0
				   WHEN [measure2] IN ('2020 LM Frcst') AND [yr] IN ('2020') AND [mnth] IN ('9', '10', '11', '12') THEN 2
				   WHEN [measure2] IN ('2021 LM Frcst') AND [yr] IN ('2021') THEN 2
				   ELSE NULL END;
	 				 
UPDATE [summary_pres]
	SET [lc_prime] = CASE WHEN [line_code] IN ('DRR', 'FRC', 'CAL', 'SAS') 
	                      THEN 'prime'
			      ELSE 'not prime' END;

UPDATE [summary_pres]
   SET [keycust2_top_customer] = 'Performance'
				  WHERE [keycust2_top_customer] IN ('Stoptech');

UPDATE [summary_pres]
   SET [keycust1_high_level] = 'Performance'
			        WHERE [keycust1_high_level] IN ('Stoptech');

UPDATE [summary_pres]
  SET [keycust2_top_customer] = 'All Other' 
				WHERE [keycust2_top_customer] IN ('Heavy Duty');



UPDATE [summary_pres]
  SET [measure2] = '2020 LM frcst' 
                    WHERE [measure] IN ('LM Frcst') 
		      AND [yr] IN ('2020')  ;


UPDATE [summary_pres]
  SET [measure2] = '2021 LM frcst' 
                    WHERE [measure] IN ('LM Frcst')  
		     AND [yr] IN ('2021')  ;



UPDATE [summary_pres]
  SET [keycust2_top_customer] = 'All Other' 
				WHERE [keycust2_top_customer] IS NULL

```
